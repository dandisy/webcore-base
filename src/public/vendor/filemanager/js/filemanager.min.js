$(document).ready(function(){function e(){if($elements=[],void 0!=current_file&&0!=current_file.preview){var e={name:"Preview",icon:"fa-eye",callback:function(e,t){$(".preview").trigger("click")}};if($elements.push(e),"image"==current_file.type&&1==optimizeOption){if(ext=current_file.name.slice(2+(current_file.name.lastIndexOf(".")-1>>>0)),"png"==ext){var t={name:"Optimize PNG",icon:"fa-compress",callback:function(e,t){omptimizeImage(current_file.path,ext)}};$elements.push(t)}if("jpg"==ext||"jpeg"==ext){var t={name:"Optimize JPG",icon:"fa-compress",callback:function(e,t){omptimizeImage(current_file.path,ext)}};$elements.push(t)}}}var a={name:"Rename",icon:"fa-keyboard-o",disabled:checkFileOrFolder(),callback:function(e,t){if($(this).data("type")&&checkFileSelected()){var a="."+current_file.name.split(".").pop(),i=current_file.name.replace(/\.[^\/.]+$/,"");$("#new-name").val(i),$("#new-ext").html(a).removeClass("hide"),$("#data-rename").removeClass("input").addClass("input-group"),$("#modalRename").find(".file-info").removeClass("hide"),$("#modalRename").find("#path").val(current_file.path),$("#modalRename").find("#type-rename").val("file"),$("#modalRename").modal("show")}$(this).data("folder")&&($("#new-name").val($(this).data("name")),$("#new-ext").addClass("hide"),$("#data-rename").removeClass("input-group").addClass("input"),$("#modalRename").find(".folder-info").removeClass("hide"),$("#modalRename").find("#type-rename").val("folder"),$("#modalRename").modal("show"))}},i={name:"Download",icon:"fa-download",disabled:checkFileOrFolder(),callback:function(e,t){""!=path_folder&&(path_folder+="/");var a;if(current_file){a="file";var i=window.open(url_download+"?path="+path_folder+current_file.name+"&name="+current_file.name+"&type="+a,"_self")}else{a="folder";var i=window.open(url_download+"?path="+temp_folder+"&name="+temp_folder+"&type="+a,"_self")}i?i.focus():alert("Please allow popups for this site")}};if(void 0!=current_file&&0!=current_file.preview){var r={name:"Cut",icon:"fa-scissors",callback:function(e,t){new PNotify({title:"File cutted",text:"Now chose new destination",type:"info"}),cutted_file=(""!=path_folder?path_folder+"/":"")+current_file.name,$(".move").removeClass("move").addClass("active paste").find("button").html('<i class="fa fa-paste"> Paste')}};$elements.push(r)}if(null!=cutted_file){var l={name:"Paste",icon:"fa-clipboard",disabled:null==cutted_file,callback:function(e,t){moveFile(cutted_file,path_folder),$(".paste").removeClass("paste active").addClass("move").find("button").html('<i class="fa fa-arrows"> Move')}};$elements.push(l)}var o={name:"Delete",icon:"fa-trash",disabled:checkFileOrFolder(),callback:function(e,t){if($(this).data("type")&&swal({title:"Are you sure?",text:"This file will be deleted!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){deleteFileorFolder(current_file.name,"file")}),$(this).data("folder")){var a=$(this).data("name");swal({title:"Are you sure?",text:"All files and folders inside this folder will by deleted!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){deleteFileorFolder(a,"folder")})}}};return $elements.push(a),$elements.push(i),$elements.push(o),$elements}function t(e){$.ajax({url:url_preview,type:"POST",data:{type:e.type,file:e.path},dataType:"text"}).done(function(e){if(e.error)return new PNotify({title:"Error",text:e.error,type:"error"}),$("#modal-preview").empty().append("Error"),!1;var t=hljs.highlightAuto(e),a='<div class="code-editor"> <span class="control"></span> <span class="control"></span><span class="control"></span><pre><code id="code-ajax-content"">'+t.value+"</code></pre></div>";return $("#modal-preview").empty().html(a),!0}).fail(function(e){return new PNotify({title:"Error",text:"Error to process request",type:"error"}),$("#modal-preview").empty().append("Error"),!1})}PNotify.prototype.options.delay=2e3;var a;addLoading=function(){$("#files_container").empty().html('<div class="loading"><img src="'+image_path+'filemanager_assets/img/loading.svg"></div>')},loadingIcon=function(){triggerObject&&(a=triggerObject.find(".icon").find("img").attr("src"),triggerObject.find(".icon").find("img").attr("src",image_path+"filemanager_assets/img/loading.svg"))},removeLoadingIcon=function(){triggerObject&&(triggerObject.find(".icon").find("img").attr("src",a),triggerObject=null)},checkFileSelected=function(){return void 0!==current_file&&null!==current_file},checkFileOrFolder=function(){return!checkFileSelected()&&(void 0===temp_folder||null===temp_folder)},getData=function(e,t,a){current_file=null,actionFileButtons(),addLoading(),null!=globalFilter&&(a=globalFilter),$.ajax({url:url_process,type:"POST",data:{folder:e,sort:t,filter:a}}).done(function(t){uploadMethod(),generatebreadcrum(e),actionRightMenu(),$("#files_container").empty(),$("#files_container").html(t)}).fail(function(e){console.log("error")})},createFolder=function(e){$.ajax({url:url_cfolder,type:"POST",data:{folder:path_folder,name:e}}).done(function(e){e.error?new PNotify({title:"Error",text:e.error,type:"error"}):(new PNotify({title:"Folder Created!",text:e.success,type:"success"}),$(".refresh").trigger("click")),$("#modalCreateFolder").modal("hide")}).fail(function(e){new PNotify({title:"Error",text:"Error to process request",type:"error"}),$("#modalCreateFolder").modal("hide")})},deleteFileorFolder=function(e,t){$.ajax({url:url_delete,type:"POST",data:{folder:path_folder,data:e,type:t}}).done(function(e){e.error?new PNotify({title:"Error",text:e.error,type:"error"}):(new PNotify({title:"Deleted!",text:e.success,type:"success"}),$(".refresh").trigger("click"))}).fail(function(e){new PNotify({title:"Error",text:"Error to process request",type:"error"})})},moveFile=function(e,t){$.ajax({url:url_move,type:"POST",data:{oldFile:e,newPath:t}}).done(function(e){e.error?new PNotify({title:"Error",text:e.error,type:"error"}):(new PNotify({title:"Success!",text:e.success,type:"success"}),cutted_file=null,$(".refresh").trigger("click"))}).fail(function(e){new PNotify({title:"Error",text:"Error to process request",type:"error"})})},renameFileorFolder=function(e,t,a){$.ajax({url:url_rename,type:"POST",data:{type:a,file:e,newName:t}}).done(function(e){e.error?new PNotify({title:"Error",text:e.error,type:"error"}):(new PNotify({title:"file"==a?"File  Renamed!":"Folder Renamed!",text:e.success,type:"success"}),$(".refresh").trigger("click")),$("#modalRename").modal("hide")}).fail(function(e){new PNotify({title:"Error",text:"Error to process request",type:"error"}),$("#modalRename").modal("hide")})},omptimizeImage=function(e,t){loadingIcon(),$.ajax({url:url_optimize,type:"POST",data:{type:t,file:e}}).done(function(e){e.error?new PNotify({title:"Error",text:e.error,type:"error"}):(new PNotify({title:"file"==t?"File  Renamed!":"Folder Renamed!",text:e.success,type:"success"}),$(".refresh").trigger("click"))}).fail(function(e){new PNotify({title:"Error",text:"Error to process request",type:"error"})})},generatebreadcrum=function(e){for(var t=e.split("/"),a='<li class="active" data-folder="Home"><a href="#">'+homeFolder+"</a></li>",e="",i=0;i<t.length;i++)""!=t[i]&&(e+=t[i]+"/",a+='<li class="active" data-folder="'+e+'"><a href="#">'+t[i]+"</a></li>");$(".breadcrumb").html(a)},actionFileButtons=function(){void 0===current_file||null===current_file?$(".delete ,.move ,.preview").removeClass("active"):"file"!=current_file.type?$(".delete ,.move ,.preview").addClass("active"):($(".preview").removeClass("active"),$(".delete ,.move").addClass("active"))},actionRightMenu=function(){$.contextMenu({selector:".filemanager-item, .upload_div",build:function(t,a){if(current_file=null,temp_folder=null,t.data("type"))if("file"!=t.data("type")){if(current_file={name:$(t).find(".name-file").text(),path:$(t).data("path"),type:$(t).data("type"),size:$(t).data("size"),relativePath:$(t).data("asset"),preview:$(t).find("img").attr("src")},"image"==current_file.type&&$(t).data("dimension")){var i=$(t).data("dimension").split("x");current_file.height=i[0],current_file.width=i[1]}}else current_file={name:$(t).find(".name-file").text(),path:$(t).data("path"),type:$(t).data("type"),size:$(t).data("size"),relativePath:$(t).data("asset"),preview:!1};else temp_folder=$(t).data("folder");return $(".file, .folder").removeClass("active"),$(t).addClass("active"),triggerObject=t,actionFileButtons(),{callback:function(e,t){process(e,t)},items:e()}},events:{hide:function(e){null==cutted_file||($(".file").removeClass("active"),actionFileButtons()),$(".file, .folder").removeClass("active")}}})},preview=function(){if(void 0===current_file||null===current_file)return!1;if("file"!=current_file.type){if($("#modal-name").text(current_file.name),$("#modal-size").text(current_file.size),$("#modal-preview").empty(),"image"==current_file.type&&($("#modal-preview").append('<img src="'+current_file.preview+'" class="img-responsive" id="modal-image">'),$("#modal-height").text(current_file.height+"px").parent().removeClass("hide"),$("#modal-width").text(current_file.width+"px").parent().removeClass("hide")),"audio"==current_file.type){var e='<div class="plyr"><audio controls crossorigin><source src="'+current_file.relativePath+'" type="audio/mpeg">Your browser does not support the audio element.</audio></div>';$("#modal-preview").append(e),plyr.setup(".plyr")}if("video"==current_file.type){var e='<div class="plyr"><video  controls crossorigin><source src="'+current_file.relativePath+'" type="video/mp4"><a href="'+current_file.preview+'">Download</a></video></div>';$("#modal-preview").append(e),plyr.setup(".plyr")}if("pdf"==current_file.type&&new PDFObject({url:current_file.relativePath,height:"500px"}).embed("modal-preview"),"text"==current_file.type){t(current_file);var e='<div class="code-editor"> <span class="control"></span> <span class="control"></span><span class="control"></span><pre><code class="language-markup">Loading...</code></pre></div>';$("#modal-preview").append(e)}$("#previewInfo").modal("toggle")}},$("#previewInfo").on("hidden.bs.modal",function(e){player=plyr.setup(".plyr")[0],void 0==player&&null==player||player.destroy(),$("#modal-width").parent().addClass("hide"),$("#modal-height").parent().addClass("hide")}),$("#modalRename").on("hidden.bs.modal",function(e){$("#modalRename").find(".file-info").addClass("hide"),$("#modalRename").find(".folder-info").addClass("hide")}),getData("","",""),$("#single-upload").click(function(){uploadMethod(),$("#single-upload-file").click()}),$(".filter").click(function(){var e=$(this).data("filter"),t=$("#sort-by").val();getData(path_folder,t,e),$(".filter").removeClass("active"),$(this).addClass("active")}),$("#sort-by").change(function(){var e=$(".filter.active").data("filter"),t=$(this).val();getData(path_folder,t,e)}),$(document).on("click",".home",function(){path_folder="";var e=$(".filter.active").data("filter"),t=$("#sort-by").val();getData("",t,e)}),$(document).on("click",".refresh",function(){var e=$(".filter.active").data("filter"),t=$("#sort-by").val();getData(path_folder,t,e)}),$(document).on("click",".preview",function(){preview()}),$(document).on("click",".folder",function(){path_folder=$(this).data("folder");var e=$(".filter.active").data("filter"),t=$("#sort-by").val();getData(path_folder,t,e)}),$(document).on("click",".file",function(e){if(e.preventDefault(),1==(window.location!=window.parent.location)){var t=window.parent;if("featured"==typeCallback){var a=location.search.split("appendId=")[1]?location.search.split("appendId=")[1]:null,i={path:$(this).data("path"),thumb:$(this).data("asset"),appendId:a};t.OnMessage(i)}return"editor"==typeCallback&&(editor=window.parent.$(window.parent.document).find("#"+editorId),fileRequested={name:$(this).find(".name-file").text(),path:$(this).data("asset")},editor.redactor("imagemanager.set",fileRequested)),!1}return $(this).hasClass("active")?(current_file=null,$(this).removeClass("active")):(current_file={name:$(this).find(".name-file").text(),path:$(this).data("path"),type:$(this).data("type"),size:$(this).data("size"),relativePath:$(this).data("asset"),preview:$(this).find("img").attr("src")},$(".file").removeClass("active"),$(this).addClass("active")),actionFileButtons(),!1}),$(document).on("click","#create-folder",function(e){var t=$("#folder-name").val();createFolder(t)});var i=function(){var e=$("#type-rename").val();if("file"==e)var t=$("#new-name").val(),a=$("#new-ext").html(),i=t+a,r=$("#modalRename").find("#path").val();else var i=$("#new-name").val(),r=temp_folder;renameFileorFolder(r,i,e)};$(document).on("click","#rename-file",function(e){i()}),$(document).on("keypress","#new-name",function(e){13==e.keyCode&&i()});var r=function(e){$("#files_container").find(".filemanager-item").each(function(){$(this).hasClass("file")&&($(this).find(".name-file").text().toUpperCase().indexOf(e.toUpperCase())!=-1?$(this).show():$(this).hide())})};$(document).on("keypress","#search",function(e){13==e.keyCode&&($(this).val()?(r($(this).val()),$("#search-button").addClass("hide"),$("#reset-button").removeClass("hide")):($(".filemanager-item").show(),$("#search-button").removeClass("hide"),$("#reset-button").addClass("hide")))}),$(document).on("click","#search-button",function(e){$("#search").val()&&(r($("#search").val()),$("#search-button").addClass("hide"),$("#reset-button").removeClass("hide"))}),$(document).on("click","#reset-button",function(e){$("#search").val(""),$(".filemanager-item").show(),$("#search-button").removeClass("hide"),$("#reset-button").addClass("hide")}),$(document).on("click",".delete",function(e){swal({title:"Are you sure?",text:"This file will be deleted!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},function(){deleteFileorFolder(current_file.name,"file")})}),$(document).on("click",".move",function(e){checkFileSelected()&&(cutted_file=(""!=path_folder?path_folder+"/":"")+current_file.name,$(this).removeClass("move").addClass("paste"),$(this).find("button").html('<i class="fa fa-paste"> Paste'))}),$(document).on("click",".paste",function(e){null!=cutted_file&&(moveFile(cutted_file,path_folder),$(this).removeClass("paste active").addClass("move").find("button").html('<i class="fa fa-arrows"> Move'))}),$(document).on("click",".breadcrumb li a",function(){var e=$(this).parent().data("folder");path_folder="Home"==e?"":e;var t=$(".filter.active").data("filter"),a=$("#sort-by").val();getData(path_folder,a,t)}),$(document).on("click",".list",function(){$(".view-type").removeClass("active"),$(this).addClass("active"),$(".item").removeClass("grid col-sm-3 big-grid col-sm-6").addClass("list col-sm-12"),$(".item").find(".icon").removeClass("col-sm-4 col-sm-2").addClass("col-sm-1"),$(".item").find(".info").removeClass("col-sm-8 col-sm-10").addClass("col-sm-11")}),$(document).on("click",".grid",function(){$(".view-type").removeClass("active"),$(this).addClass("active"),$(".item").removeClass("list col-sm-12 big-grid col-sm-6").addClass("grid col-sm-3"),$(".item").find(".icon").removeClass("col-sm-1 col-sm-2").addClass("col-sm-4"),$(".item").find(".info").removeClass("col-sm-11 col-sm-10").addClass("col-sm-8")}),$(document).on("click",".big-grid",function(){$(".view-type").removeClass("active"),$(this).addClass("active"),$(".item").removeClass("list col-sm-12 grid col-sm-3").addClass("big-grid col-sm-6"),$(".item").find(".icon").removeClass("col-sm-1 col-sm-4").addClass("col-sm-2"),$(".item").find(".info").removeClass("col-sm-11 col-sm-8").addClass("col-sm-10")})});